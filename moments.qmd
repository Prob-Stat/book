# 期待値、分散、モーメント

## 期待値

::: {#def-exp}
## 期待値

離散型確率変数 $X$ が$A\subseteq\mathbb{R}$に値を取るとき、その期待値は

\begin{align*}
\expt{X} &= \sum_{\omega \in \Omega} X(\omega) P(\{\omega\})\\
&= \sum_{x\in A} x P(\{\omega\mid X(\omega)=x\})\\
&= \sum_{x\in A} x \Pr(X=x)\\
&= \sum_{x\in A} x f_X(x)
\end{align*}

と定義される。ここで、右辺の和が絶対収束しない場合は(適当な順番で和を取って収束したとしても)期待値は定義されない。
連続型確率変数 $X$ が確率密度関数 $f_X$ を持つとき、その期待値は

$$
\expt{X}= \int_{-\infty}^\infty x f_X(x) \mathrm{d}x
$$

と定義される。
:::

::: {#lem-exp}
### Law of the unconscious statistician (LOTUS)
任意の関数 $g\colon\mathbb{R}\to\mathbb{R}$ について、

1. $X$ が離散型確率変数のとき、
\begin{align*}
\expt{g(X)} &= \sum_{x} g(x) f_X(x).
\end{align*}
1. $X$ が連続型確率変数で確率密度関数を持つとき、
\begin{align*}
\expt{g(X)} &= \int_{-\infty}^\infty g(x) f_X(x) \mathrm{d}x.
\end{align*}
:::
::: {.proof}
$X$ を離散型確率変数とする。
\begin{align*}
\expt{g(X)}
&= \sum_{x} x f_{g(X)}(x)\\
&= \sum_{x} x \Pr(g(X) = x)\\
&= \sum_{x} x \Pr(\{\omega\in\Omega\mid g(X(\omega)) = x\})\\
&= \sum_{x} x \Pr\left(\bigcup_{y\in\mathrm{Image}(X)\colon\, g(y) = x}\{\omega\in\Omega\mid X(\omega) = y\}\right)\\
&= \sum_{x}\sum_{y\in\mathrm{Image}(X)\colon\, g(y) = x} x \Pr\left(\{\omega\in\Omega\mid X(\omega) = y\}\right)\\
&= \sum_{y\in\mathrm{Image}(X)} g(y) f_X(y)
\end{align*}

$X$ が連続型確率変数で確率密度関数を持つとする。
\begin{align*}
\expt{g(X)}
&= \int_{-\infty}^\infty x f_{g(X)}(x)\mathrm{d}x\\
\end{align*}
:::

::: {#lem-exp}
## 期待値の性質

1. 任意の $c\in\mathbb{R}$ について $\expt{X+c} = \expt{X}+c$
1. 任意の $c\in\mathbb{R}$ について $\expt{cX} = c\expt{X}$
:::
::: {.proof}

$X$ が離散確率変数のとき、$X$ の値域を $A$ とすると $X+c$ の値域は $A+c\coloneqq\{a+c\mid a\in A\}$ なので、
\begin{align*}
\expt{X+c} &= \sum_{x\in A+c} x f_{X+c}(x)\\
&= \sum_{x\in A+c} x \Pr(X+c = x)\\
&= \sum_{x'\in A} (x'+c) \Pr(X = x')\qquad(x' = x-c)\\
&= \expt{X}+c.
\end{align*}

$X$ が連続確率変数のとき、
\begin{align*}
\expt{X+c} &= \int_{-\infty}^\infty x f_{X+c}(x) \mathrm{d} x\\
&= \int_{-\infty}^\infty x f_{X}(x-c) \mathrm{d} x\\
&= \int_{-\infty}^\infty (x'+c) f_{X}(x') \mathrm{d} x'\qquad(x'=x-c)\\
&= \expt{X}+c.
\end{align*}

$c=0$ のとき $cX = 0$ なので、$\expt{cX} = 0 = c\expt{X}$.

$X$ が離散確率変数のとき、$X$ の値域を $A$ とすると $cX$ の値域は $cA\coloneqq\{ca\mid a\in A\}$ なので、
\begin{align*}
\expt{cX} &= \sum_{x\in cA} x f_{cX}(x) \\
&= \sum_{x\in cA} x \Pr(cX = x)\\
&= \sum_{x'\in A} cx' \Pr(X = x') \qquad(x' = x/c)\\
&= c\expt{X}
\end{align*}

$X$ が連続確率変数のとき、
\begin{align*}
\expt{cX} &= \int_{-\infty}^\infty x f_{cX}(x) \mathrm{d} x\\
&= \int_{-\infty}^\infty x \frac1{|c|} f_{X}(x/c) \mathrm{d} x\\
&=
\begin{cases}
 \int_{-\infty}^\infty cx'f_{X}(x') \mathrm{d} x'& \text{if } c > 0\\
 \int_{\infty}^{-\infty} -cx'f_{X}(x') \mathrm{d} x'& \text{if } c < 0\\
\end{cases}
\qquad (x' = x/c)\\
&= \int_{-\infty}^\infty c x' f_{X}(x') \mathrm{d} x'\\
&= c\expt{X}
\end{align*}
:::


::: {#thm-markov}
## マルコフの不等式

非負確率変数 $X$ と $a>0$ について
$$
\Pr(X\ge a)\le\frac{\expt{X}}{a}.
$$
:::
::: {.proof}
離散確率変数の場合の証明を与える。
密度関数を持つ連続確率変数の場合も和を積分に変えた証明が成立する。
\begin{align*}
\expt{X} &= \sum_{x\in A} f_X(x) x\\
&= \sum_{x\ge a} f_X(x) x + \sum_{x < a} f_X(x) x\\
&\ge \sum_{x\ge a} f_X(x) x\qquad\qquad (X\ge 0)\\
&\ge \sum_{x\ge a} f_X(x) a\\
&= \Pr(X\ge a) a.
\end{align*}
:::

<!--
::: {#exm-exp}
## 確率変数と期待値の例

非負整数に値を取る確率変数が

$$
\Pr(X = n) = \frac1{2^{n+1}}
$$

を満たすとき、

\begin{align*}
\expt{X} &= \sum_{n\ge 0}\frac{n}{2^{n+1}}\\
&= \left.\sum_{n\ge 0}\frac{n}{x^{n+1}}\right|_{x=2}\\
&= \left.\left(-\sum_{n\ge 0}\frac{1}{x^{n}}\right)'\right|_{x=2}\\
&= \left.\left(-\frac{1}{1-x^{-1}}\right)'\right|_{x=2}\\
\end{align*}
:::
-->

## 分散
::: {#def-exp}
## 分散

確率変数 $X$ が期待値を持つとき、その分散を

$$
\var{X}= \expt{(X-\expt{X})^2}
$$

と定義する。
:::

確率変数 $X$ が分散を持つとき、

\begin{align*}
\var{X} &= \expt{(X-\expt{X})^2}\\
&= \expt{X^2-2X\expt{X}+\expt{X}^2}\\
&= \expt{X^2}-2\expt{X}\expt{X}+\expt{X}^2\\
&= \expt{X^2}-\expt{X}^2
\end{align*}

である。
分散は直感的には期待値からのはずれ具合を表す値である。

::: {#thm-chebyshev}
## チェビシェフの不等式

非負確率変数 $X$ と $a>0$ について
$$
\Pr(|X-\expt{X}|\ge a)\le\frac{\var{X}}{a^2}.
$$
:::
::: {.proof}
\begin{align*}
\Pr(|X-\expt{X}|\ge a)&= \Pr((X-\expt{X})^2\ge a^2)\\
&\le
\frac{\expt{(X-\expt{X})^2}}{a^2} = \frac{\var{X}}{a^2}
\end{align*}
:::

## モーメントとモーメント母関数

::: {#def-moment}
## モーメント

確率変数 $X$ と正の整数 $n\in\mathbb{Z}_{\ge 1}$ について、

$$
\expt{X^n}
$$

を $X$ の $n$ 次モーメントという。
:::

::: {#def-mg}
## モーメント母関数(積率母関数)

確率変数 $X$ について、

$$
M_X(t) \coloneqq \expt{\mathrm{e}^{tX}}\qquad t\in\mathbb{R}
$$

を $X$ の**モーメント母関数**という。
すべての $t\in\mathbb{R}$ で $M_X(t)$ が存在しない場合もある。
また、

$$
K_X(t) \coloneqq \log M_X(t)
$$
を $X$ の**キュムラント母関数**という。
:::

<!--
::: {#thm-convergence}

## ルベーグの優収束定理(概要)

関数列 $(f_n)_{n\ge 0}$ がある関数 $f$ に各点収束するとする。
また、ある関数 $g$ が存在し、

1. $|f_n(x)|\le g(x)$.
1. $\int_{-\infty}^\infty g(x)\mathrm{d}x<\infty$.

を満たすとする。
このとき、

$$
\lim_{n\to\infty} \int_{-\infty}^\infty f_n(x)\mathrm{d}x = \int_{-\infty}^\infty f(x)\mathrm{d}x.
$$

:::
-->

今後は以下の補題を認めることにする。証明にはルベーグ積分の知識が必要である。

::: {#lem-moment}

確率変数 $X$ について、ある $\epsilon >0$ が存在し、モーメント母関数 $M_X(t)$ が **$t\in(-\epsilon,\epsilon)$ で存在するとき**、

\begin{align*}
M_X(t) &=\sum_{n\ge 0}\frac{\expt{X^n}}{n!}t^n\\
\expt{X^n} &= \left.\frac{\mathrm{d}^n M_X(t)}{\mathrm{d} t^n}\right|_{t=0}.
\end{align*}
:::
::: {.proof}
(概要)
\begin{align*}
M_X(t) &= \expt{\mathrm{e}^{tX}}\\
&=\expt{\sum_{n\ge 0}\frac{(tX)^n}{n!}}\\
&=\sum_{n\ge 0}\expt{\frac{(tX)^n}{n!}}\qquad\text{\textsf{(この無限和と期待値の交換が定理の条件より正当化される)}}.
\end{align*}
:::

::: {#cor-cumulant}
確率変数 $X$ について、ある $\epsilon >0$ が存在し、モーメント母関数 $M_X(t)$ が **$t\in(-\epsilon,\epsilon)$ で存在するとき**、

\begin{align*}
\left.\frac{\mathrm{d} K_X(t)}{\mathrm{d} t}\right|_{t=0} &= \expt{X}\\
\left.\frac{\mathrm{d}^2 K_X(t)}{\mathrm{d} t^2}\right|_{t=0} &=  \var{X}.
\end{align*}
:::
::: {.proof}
\begin{align*}
\left.\frac{\mathrm{d} K_X(t)}{\mathrm{d} t}\right|_{t=0} &= \left.\frac{M'_X(t)}{M_X(t)}\right|_{t=0}=\expt{X}\\
\left.\frac{\mathrm{d}^2 K_X(t)}{\mathrm{d} t^2}\right|_{t=0} &= \left.\frac{M''_X(t)M_X(t) - M'_X(t)^2}{M_X(t)^2}\right|_{t=0} = M''_X(0) - M'_X(0)^2 = \var{X}.
\end{align*}
:::

また、重要度は低くなるが、

\begin{align*}
\left.\frac{\mathrm{d}^3 K_X(t)}{\mathrm{d} t^3}\right|_{t=0} &= \expt{(X - \expt{X})^3}\\
\left.\frac{\mathrm{d}^4 K_X(t)}{\mathrm{d} t^4}\right|_{t=0} &= \expt{(X - \expt{X})^4} - 3\var{X}^2
\end{align*}

が成り立つ。
一般に
\begin{align*}
\kappa_n(X) &\coloneqq \left.\frac{\mathrm{d}^n K_X(t)}{\mathrm{d} t^n}\right|_{t=0}
\end{align*}
を $X$ の **$n$ 次キュムラント** と呼ぶ。
