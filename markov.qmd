# マルコフ連鎖

## 確率過程とマルコフ連鎖
共通の確率空間 $(\Omega,\,P)$ 上の長さ無限の確率変数列 $X_0,X_1,X_2,\dotsc$ を**離散時間確率過程**という。
各時刻 $t=0,1,2,\dotsc,$ について、 $X_t$ を時刻 $t$ における状態と考える。
離散時間確率過程 $X_0,X_1,\dotsc,$ の各確率変数の像が**有限集合** $S$ であり、
任意の $t\in\mathbb{Z}_{\ge 0}$ と $x_0,\dotsc, x_{t+1}\in S$ について
\begin{align*}
\Pr(X_{t+1} = x_{t+1}\mid X_{t} = x_t,\dotsc,\,X_1=x_1,\,X_0=x_0)
&= \Pr(X_{t+1} = x\mid X_{t} = x_t)
\end{align*}
を満たすとき、それを**有限状態マルコフ連鎖**という。

さらに、
\begin{align*}
\Pr(X_{t+1} = x_{t+1}\mid X_{t} = x_t)
\end{align*}
が $t$ に依存しないとき**時間的に均一な有限状態マルコフ連鎖**という。

以下では時間的に均一な有限状態マルコフ連鎖を考える。
有限状態マルコフ連鎖の場合、状態 $S$ は実数の有限部分集合と考えるより、単に有限集合と考えた方が自然な場合も多い。
例えば $S = \{ 晴れ、曇り、雨\}$ や。
このとき、状態集合を便宜上 $S=\{1,2,\dotsc,n\}$ とおき、
\begin{align*}
p_{i,j} &= \Pr(X_{t+1} = j\mid X_{t} = i)
\end{align*}
とする。
この $p_{i,j}$ を $(i,j)$ 成分に持つ $n\times n$ 行列 $T$ を**マルコフ遷移行列**という。
マルコフ遷移行列は非負行列であり、行和が1である。
初期確率ベクトル $\pi$ を $\pi_i = \Pr(X_0=i)$ を満たす行ベクトルとする。
\begin{align*}
\Pr(X_1=j) &= \sum_{i} \Pr(X_0=i) \Pr(X_1=j\mid X_0=i)\\
&=\sum_{i} \pi_i\, p_{i, j}\\
&=(\pi T)_j
\end{align*}
よって、
\begin{align*}
\Pr(X_n=j) &= (\pi T^n)_j
\end{align*}
である。

この確率について、

1. もっと単純な数式で表す。
1. 効率的なアルゴリズムを与える。
1. $n\to\infty$ の漸近

遷移行列 $T$ が $T=UDU^{-1}$ と対角化できるとき、

## グラフ上のランダムウォーク
:::{#def-graph}
### グラフ
有限集合 $V$ と集合 $E\subseteq \{\{u,v\}\mid u,\, v\in V, u\ne v\}$ のペア $G=(V,\,E)$ を(無向単純)グラフという。
$V$ の元を**頂点**、$E$ の元を**辺**と呼ぶ。
:::

グラフ $G=(V,\,E)$ と $v\in V$ について、
\begin{align*}
d_v&=|\{u\in V\mid \{u,v\}\in E\}|
\end{align*}
を $v$ の**次数**という。
次数0の頂点を**孤立頂点**という。

:::{#def-rw}
### グラフ上のランダムウォーク
孤立頂点を持たないグラフ $G=(V=\{1,2,\dotsc,n\},\,E)$ 上のランダムウォークは $S=V$ であり、
任意の初期確率ベクトル $\pi$ と
\begin{align*}
p_{i,j} &= \frac1{d_i}
\end{align*}
で定義される。
:::

:::{#lem-rw}
グラフ上のランダムウォークの遷移行列は対角化可能であり、固有値はすべて実数である。
:::
:::{.proof}
グラフ $G$ の次数行列を
\begin{align*}
D_{i,j} &= d_i\delta_{i,j}
\end{align*}
と定義する。
\begin{align*}
Q &= \sqrt{D} P \sqrt{D}^{-1}
\end{align*}
と
:::

## 確率の計算アルゴリズム

:::{#def-fps}
### 形式的冪級数
:::

時刻 $n$ で状態 $j$ の確率
\begin{align*}
\Pr(X_n=j) &= (\pi T^n)_j
\end{align*}
を計算するアルゴリズムを考える。
\begin{align*}
\Pr(X_n=j) &= (\pi T^n)_j\\
&= \left( [x^n] \sum_{t\ge 0}\pi T^t x^t\right)_j
\end{align*}

